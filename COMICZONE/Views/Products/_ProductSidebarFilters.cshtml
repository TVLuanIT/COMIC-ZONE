@using Microsoft.AspNetCore.Routing

@{
    var activeGroup = ViewBag.ActiveGroup as string;
    var selectedValue = ViewBag.SelectedValue as string;
}

@foreach (var filterGroup in Model)
{
    var key = filterGroup.Key;
    string paramName = key switch
    {
        "Tác giả" => "author",
        "Họa sĩ" => "artist",
        "Dịch giả" => "translator",
        "Series" => "series",
        "Tag" => "tag",
        "NXB" => "publisher",
        "Nhà phát hành" => "distributor",
        _ => "keyword"
    };

    var isActive = activeGroup == paramName;
    var collapseId = "collapse-" + paramName;

    <div class="mb-3">
        <button class="btn btn-outline-secondary w-100 d-flex justify-content-between align-items-center"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#@collapseId"
                aria-expanded="@isActive">
            @key
            <i class="bi bi-chevron-down"></i>
        </button>

        <ul class="list-unstyled collapse @(isActive ? "show" : "") mt-2 ms-2" id="@collapseId">
            @foreach (var item in filterGroup.Value)
            {
                var isSelected = selectedValue == item;

                var routeValues = new RouteValueDictionary();
                routeValues[paramName] = item;

                <li>
                    <a class="d-block py-1 text-decoration-none @(isSelected ? "fw-bold text-primary" : "text-dark")"
                       href="@Url.Action("Index", "Products", routeValues)">
                        @item
                    </a>
                </li>
            }
        </ul>
    </div>
}