@model IEnumerable<COMICZONE.Models.ProductReview>
@using System.Globalization

<div class="product-reviews mt-4">
    <h3>Bình luận</h3>

    @if (Model == null || !Model.Any())
    {
        <p class="text-muted">Chưa có bình luận nào cho sản phẩm này.</p>
    }
    else
    {
        <div class="list-group">
            @foreach (var review in Model)
            {
                <div class="list-group-item mb-2 border rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>@review.User?.Username ?? "Người dùng ẩn danh"</strong>
                            <span class="text-muted ms-2">
                                @(review.Createdat.HasValue? review.Createdat.Value.ToString("dd/MM/yyyy HH:mm") : "-")
                            </span>
                        </div>
                        <div>
                            @* Hiển thị Rating 1-5 *@
                            @for (int i = 1; i <= 5; i++)
                            {
                                if (i <= review.Rating)
                                {
                                    <span class="text-warning">&#9733;</span> @* filled star *@
                                }
                                else
                                {
                                    <span class="text-secondary">&#9733;</span> @* empty star *@
                                }
                            }
                        </div>
                    </div>

                    <div class="mt-2">
                        @if (!string.IsNullOrWhiteSpace(review.Reviewcontent))
                        {
                            <p class="mb-1">@review.Reviewcontent</p>
                        }
                        else
                        {
                            <p class="text-muted mb-1"><em>Người dùng chưa viết nội dung</em></p>
                        }
                    </div>

                    <div class="d-flex justify-content-end">
                        @* Button xem chi tiết nếu cần *@
                        <button class="btn btn-sm btn-outline-primary"
                                type="button"
                                data-bs-toggle="collapse"
                                data-bs-target="#reviewDetail-@review.Reviewid"
                                aria-expanded="false"
                                aria-controls="reviewDetail-@review.Reviewid">
                            Xem chi tiết
                        </button>
                    </div>

                    @* Nội dung chi tiết collapsible *@
                    <div class="collapse mt-2" id="reviewDetail-@review.Reviewid">
                        <div class="card card-body">
                            <p><strong>ID Review:</strong> @review.Reviewid</p>
                            <p><strong>Đánh giá:</strong> @review.Rating / 5</p>
                            <p><strong>Người dùng:</strong> @review.User?.Username ?? "Ẩn danh"</p>
                            <p><strong>Ngày tạo:</strong> @(review.Createdat.HasValue? review.Createdat.Value.ToString("dd/MM/yyyy HH:mm") : "-")</p>
                            <p><strong>Trạng thái:</strong> @(review.Isapproved ?? false ? "Đã duyệt" : "Chưa duyệt")</p>
                            @if (!string.IsNullOrWhiteSpace(review.Reviewcontent))
                            {
                                <p><strong>Nội dung:</strong> @review.Reviewcontent</p>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>